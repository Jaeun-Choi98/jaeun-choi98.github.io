---
layout: post
title: 'Linux init'
tags: 'linux'
date: 2023-10-11 00:00:00
---

리눅스 시스템의 부팅 과정은 여러 단계를 거치며, 하드웨어의 전원을 켜고 시스템이 실행될 때부터 시작됩니다. 일반적으로 부팅 과정은 다음과 같습니다.

1. **POST (Power-On Self Test)**: 하드웨어 점검 수행
2. **부트로더 (GRUB 등)**: 커널 로드
3. **커널 초기화**: 하드웨어 및 파일 시스템 마운트
4. **init 시스템 실행**: 시스템 초기화 및 서비스 시작

이 과정에서 시스템의 초기화를 담당하는 init 시스템이 실행되며, 이는 리눅스 배포판과 버전에 따라 다를 수 있습니다.

<br>
<br>

## **1. init 시스템**

---

### **전통적인 init 방식**

초기 리눅스 시스템에서는 `init`이 첫 번째 프로세스로 실행되었으며, `/etc/inittab` 파일을 참고하여 런레벨에 맞는 초기화 스크립트를 실행했습니다. `init`은 다음과 같은 기능을 수행했습니다.

- **런레벨 설정**: `/etc/inittab`을 기반으로 시스템의 상태를 결정
- **시스템 초기화**: `/etc/rc.d/init.d`에 있는 스크립트 실행
- **터미널 프로세스 시작**: `getty`를 실행하여 사용자 로그인 프롬프트 제공

그러나, 전통적인 `init` 방식은 병렬 처리가 어렵고 부팅 속도가 느리다는 단점이 있었습니다. 이를 개선하기 위해 `systemd` 를 사용한 초기화 시스템을 사용합니다.

<br>

## **2. systemd**

---

`systemd` 는 시스템 관리자의 역할을 합니다. 초기화 시스템, 로깅 시스템, 서비스 시스템 등 여러 시스템을 관리자 역할을 수행합니다. 그 중 초기화 시스템은 기존 `init` 시스템을 대체하며, 더 빠르고 효율적인 방식으로 초기화를 실행합니다.

### **systemd의 주요 특징**

- **병렬 처리**: 부팅 시 여러 서비스를 동시에 실행하여 속도 향상
- **의존성 관리**: 서비스 간 종속 관계를 정의하여 실행 순서를 최적화
- **동적 유닛 관리**: 실행 중에도 유닛을 추가/삭제 가능
- **로깅 시스템 통합**: `journald`를 통한 중앙 집중식 로깅

### **systemd 유닛 파일 구조**

systemd는 `유닛(Unit)` 파일을 통해 시스템의 자원을 관리합니다. 주요 유닛 유형은 다음과 같습니다.

- **서비스 유닛 (`.service`)**: 특정 프로그램 실행을 관리
- **타겟 유닛 (`.target`)**: 여러 유닛을 그룹화하여 실행 순서 지정
- **소켓 유닛 (`.socket`)**: 소켓 기반의 서비스 관리
- **마운트 유닛 (`.mount`)**: 파일 시스템 마운트 관리
- **타이머 유닛 (`.timer`)**: 특정 시간 또는 간격으로 서비스 실행

### **유닛 파일 예제**

다음은 `example.service`라는 간단한 서비스 유닛 파일 예제입니다.

```
[Unit]
Description=Example Service
After=network.target

[Service]
ExecStart=/usr/bin/example
Restart=always
User=nobody
Group=nogroup

[Install]
WantedBy=multi-user.target

```

이 파일은 `example`이라는 프로그램을 실행하는 서비스 유닛을 정의합니다. `After=network.target`은 네트워크가 활성화된 후 실행됨을 의미합니다.

### **유닛 파일 경로**

- `/lib/systemd/system/` : 패키지 관리자에 의해 설치된 기본 유닛 파일 위치
- `/etc/systemd/system/` : 사용자가 직접 생성하거나 수정한 유닛 파일 저장 (우선순위 높음)
- `/run/systemd/system/` : 실행 중 동적으로 생성된 유닛 파일 저장 (재부팅 시 초기화됨)

<br>

## **3. 로그인 및 초기화 파일**

---

### **로그인 시 실행되는 파일**

사용자가 로그인할 때 실행되는 초기화 파일은 다음과 같습니다.

1. `/etc/profile` : 시스템 전역 환경 변수 설정
2. `/etc/profile.d/*.sh` : 추가적인 환경 설정 스크립트 실행
3. `~/.profile` : 사용자의 로그인 셸 환경 설정
4. `~/.bash_profile` : 로그인 셸 환경 설정 (Bash로 로그인 될 때 실행)
5. `~/.bashrc` : 비로그인 셸 실행 시 환경 설정(Bash만)
6. `/etc/bashrc` : 전역적인 Bash 설정

기본적으로 `/etc/profile`과 `~/.profile`은 로그인할 때 실행되며, `~/.bashrc`는 새로운 Bash 셸이 실행될 때마다 실행됩니다.

환경 변수는 `/etc/profile` 또는 `~/.profile`에서 설정하는 것이 일반적입니다.
