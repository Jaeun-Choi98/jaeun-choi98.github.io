---
layout: post
title:  "Linux shell"
tags: "linux"
date:   2023-10-11 00:00:00
---

쉘은 GNU/리눅스 운영 체제에서 사용되는 사용자와 컴퓨터 간의 상호작용을 가능하게 하는 인터페이스라고 한 문장으로 설명할 수 있지만, 이번 포스트에선 쉘에 대한 내용들을 풀어서 정리하고자 합니다. 쉘은 간단히 말해서 인터프리터 프로그램이고 하나의 프로세스입니다. 서버에 들어가서 보이는 검은 화면과 사용자의 입력을 기다리는 프롬프트는 서버 부팅 시 초기화되는 설정 값을 실행하고 난 뒤의 하나의 쉘(자식 쉘)입니다.

<br>
<br>
<br>

### **init**
리눅스는 부팅 시 init라는 첫 번째 프로세스가 시작되고 init과 연결된 수많은 프로세스들이 자신만의 PID를 가지고 생성되기 시작합니다. init은 시스템을 초기화하고 터미널 라인을 오픈하기 위한 작업 들을 합니다. 이때 stdin, stdout, stderr를 키보드, 모니터(/dev/tty)로 설정합니다. 

init 프로세스는 /etc/rc.d/init.d 에 런레벨별로 설정되어 있는 쉘 스크립트를 실행합니다. 부팅 시 실행할 런레벨은 /etc/inittab 파일에 설정되어 있습니다. 

<br>
<br>

### **초기화 파일들**
init 프로세스가 실행되면, 여러 자식 프로세스가 실행되고 그 중 getty 프로세스를 생성합니다. 이 프로세스는 사용자에게 터미널을 오픈하고 모니터에 로그인 프롬프트를 보여줍니다. 그리고 나서 /bin/login을 실행합니다. 이때 로그인에 성공하면, 환경 설정이 초기화되고 쉘 프로세스는 /etc/profile 파일을 찾아서 실행하게 됩니다. /etc/profile 파일에는 export 명령을 사용하여 각 변수들을 서브쉘로 전달하고 있고 /etc/profile.d 에 있는 .sh파일을 실행하고 있습니다. 

그리고 나서, 유저 홈에 있는 .bash_profile을 일반적으로 읽게 됩니다. 파일의 코드를 보면 먼저 .bashrc 파일이 있으면 실행하게 하고, 환경 변수 PATH에 자신의 홈에 있는 bin 디렉터리도 추가해줍니다. .bashrc 파일에는 앨리어스들과 LANG 환경 변수들이 설정되어 있고, 마지막으로 /etc/bashrc가 있으면 /etc/bashrc 를 실행하게 합니다.

기본적으로 profile이 포함하는 파일에는 환경 변수를 입력하거나 설정 파일들을 실행시키고 bash가 포함된 파일들은 앨리어스 및 사용자 편의 변수들을 설정합니다. 일반적으로 /etc 에 있는 디렉터리를 사용하기 보단 사용자 홈 디렉터리에 있는 ~/.bashrc 또는 ~/.bash_profile 를 변경하여 사용합니다.

<br>
<br>

### **프로세스**
리눅스에서 쉘은 앨리어스, 키워드, 함수, 빌트인 내장명령은 현재 쉘에서 실행되지만, 실행 파일은 자식 프로세스를 생성해서 실행 파일을 실행시킵니다. 이때, 부모 프로세스는 wait 상태가 되고 자식 프로세스가 실행이 끝나고 exit 시스템 콜을 받고 난 후 다시 부모 쉘이 시작됩니다. 

정리해보면 우리가 보는 검은 화면은 리눅스가 부팅되고 여러 설정 파일들이 겹겹이 실행된 상태입니다.