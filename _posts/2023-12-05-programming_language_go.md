---
layout: post
title: 'Programing Language_Golang'
tags: 'Go'
date: 2023-12-05 00:00:00
---

Golang 언어에 대한 포스터를 작성하고자 합니다. ‘Tucker의 Go 언어 프로그래밍’이란 책을 통해 학습했던 내용을 정리하고자 합니다. 정리할 내용은 변수 간 값의 전달, 스택과 힙, 고루틴과 컨텍스트, 채널, 클래스와 상속입니다. 위의 내용에 대해 쓸려고 하는 이유는 Golang 만의 다른 점이 있다고 생각했기 때문입니다. 위의 내용 말고도 Golang 언어의 특징은 다음과 같습니다. 컴파일 언어, 강 타입 언어이면서 기본적으로 라이브러리를 모두 정적 링크합니다. 그래서, DLL의 의존 문제를 회피할 수 있고, 런타임 실행 시간도 빠릅니다. 하지만, 정적 링크하기 때문에 파일 크기가 크고, 라이브러리의 수정이 생기면 다시 컴파일 해줘야 한다는 불편함도 있습니다.

<br>

### **변수 간 값의 전달**

---

**Go 언어에서 변수 간 값의 전달은 타입에 상관없이 항상 복사로 일어납니다.** 대입 연사자와 함수 호출 시 인수값 전달에도 항상 복사로 전달됩니다. 값 전달은 우변의 메모리 공간을 좌변의 메모리 공간에 복사함으로써 일어납니다. 복사하는 크기는 타입의 크기와 같습니다.

예를 들어, Go 언어에서 배열 간 대입 및 인수 전달은 다음과 같이 일어납니다. 우변의 타입크기\*배열크기 만큼 좌변 메모리 공간에 복사합니다. 흔히, 깊은 복사가 일어납니다. 구조체의 경우에도 같습니다. 구조체 내부에 정의한 필드의 총 타입 크기 만큼(메모리 정렬) 복사가 일어납니다.

추가적으로 슬라이스, 스트링, 맵, 채널, 인터페이스 간 대입 및 인수 전달 시 참조형 변수처럼 작동하는 것처럼 보이지만, 사실은 내부적으로는 구조체로 구현되어 있으며 실제 데이터를 가리키는 포인터 필드가 있고 복사 시 우변의 총 필드 메모리 공간만큼 좌변 메모리 공간에 복사합니다. 그래서, 기본값으로 nil을 가리키며 대입 및 인수 전달 시 얕은 복사가 일어나는 것처럼 보입니다. **인터페이스의 경우 두 개의 필드를 가진 구조체로 구현됩니다. 하나는 값의 타입 정보(포인터 필드)를 가지고 있고, 다른 하나는 값 자체를 가지고 있습니다.**

그리고, 함수 타입은 포인터와 마찬가지로 기본 타입이며 값으로 메모리 주소를 가집니다.

<br>

### **스택과 힙**

---

대부분의 프로그래밍 언어는 메모리를 할당할 때 스택 메모리 영역 또는 힙 메모리 영역을 사용하고, C/C++ 에서는 malloc() 함수를 통해 힙 메모리 공간을 할당하고, 자바에서는 클래스 타입을 힙에, 기본 타입을 스택에 할당합니다. **Go 언어에서는 탈출 검사(escape analysis)를 해서 어느 메모리에 할당할지를 결정합니다.** 그래서, Go 언어에서는 메인 함수가 아닌 다른 함수에서 객체를 생성해도 메인 함수에서 해당 객체를 사용한다면 스택이 아닌 힙 메모리에 객체를 할당하게 됩니다. 이러한 작동 방식은 생성자 기능이 없는 Go에서 구조체의 디폴트 생성자와 같은 역할을 하는 함수 사용을 가능하게 합니다.

<br>

### **고루틴**

---

고루틴은 다른 언어에서 사용하는 쓰레드와 비슷합니다. 하지만 다른 점은 고루틴은 완전한 동시성을 제공합니다. CPU는 CPU 코어 당 한 개의 프로세스를 처리할 수 있고 하이퍼 쓰레드 방식을 사용하면 코어 당 두 개의 프로세스를 처리할 수 있습니다. 사용자가 따로 코어(하이퍼 쓰레드의 경우 논리CPU)에 프로세스를 나눠서 실행하지 않으면 컨텍스트 스위치 비용이 발생하게 됩니다. 흔히, 하나의 논리 CPU에 부모 프로세스에서 fork()한 여러 자식 프로세스(커널 쓰레드)를 생성하는 경우나 하나의 프로세스에서 사용자 쓰레드를 여러 개 생성할 시 CPU의 처리량에는 변함 없는 것처럼 물리적인 동시성을 처리하기 위해서는 부가적인 작업이 필요합니다. 고루틴은 이러한 작업을 내부적으로 지원합니다. 여기서 중요한 점은 코어 당 쓰레드(고루틴)가 모두 연결되어 있고 남은 쓰레드 작업이 있다면 코어에서 쓰레드가 다 처리될 때까지 남은 쓰레드가 대기한다는 점입니다.

<br>

### **채널과 컨텍스트**

---

채널과 컨텍스트는 고루틴의 동시성 프로그래밍을 도와주는 역할을 합니다. 채널은 고루틴끼리 메시지를 전달할 수 있는 메시지 큐입니다. 흔히 동시성(다중 처리) 프로그래밍을 할 시 공유된 자원을 사용하는 경우 자원에 모순성이 생기는 문제가 발생할 수 있습니다. 이러한 문제를 해결하기 위해서는 임계 영역, 이벤트 객체, 뮤텍스 등의 방법을 사용해 동기화 작업을 해주어야 합니다. 하지만, 동기화 작업을 할 시 성능이 떨어질 수 있기에 Go 언에서는 채널과 컨텍스트를 사용해 공유된 자원에 역할을 나누는 방법을 사용합니다.

<br>

### **클래스와 상속**

---

Go 언어에서는 클래스와 상속을 지원하지 않습니다. 대신 인터페이스를 사용해서 객체 지향 프로그래밍을 지원합니다. 인터페이스 구현 시 Go 언어는 ‘덕 타이핑’을 통해 구현합니다. 이러한 특징은 객체 간 상속 관계가 아닌 포함 관계를 사용하도록 합니다. 상속 관계가 아닌 포함 관계를 사용함으로써 구체화된 객체는 추상 객체에 의존(DIP)하기 쉬워집니다.
